// 1. Реализуйте калькулятор для обратной польской записи (RPN) арифметических выражений. 
// 2. Напишите функции перевода арифметический выражений в RPN и наоборот.

import lingo/pegcode/driver;
import string;
import math/math;

Expression ::= Multiply, Add, Const;

Multiply    (l : Expression, r : Expression);
Add         (l : Expression, r : Expression);
Const       (const : int);


lingoRPNGrammar() {
    compilePegGrammar("#include lab6.lingo");
}

ExprToString(expr: Expression) -> string {
    switch(expr) {
        Multiply(l, r)  : "(" + ExprToString(l) + ExprToString(r) + "*" + ")";
        Add(l, r)       : "(" + ExprToString(l) + ExprToString(r) + "+" + ")";
        Const(const)    : i2s(const);
    }
}

// 1.
calculate(expr: Expression) -> Maybe<int> {}

main() {
    // get an expression
    expr = getUrlParameter("expr");

    usage : string = "Usage: lab6.flow -- \"expr=<expression>\"";
	
    if (expr == "") {
		println("Expressinon expected");
		println(usage);
		quit(-1);
	} else {
        e = parsic(lingoGrammar(), expr, defaultPegActions);
        println(e);

        switch(calculate(e)) {
            Some(result)    : println(ExprToString(e) + " = " + i2s(result));
            None()          : println("Error while calculating");
        }
		quit(0);
	}
}